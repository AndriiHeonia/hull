<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Hull.js by Andrii Heonia</title>
    <script src="./javascripts/hull.js"></script>
    <script src="./javascripts/dbscan.js"></script>
    <script src="./javascripts/dataTorch.js"></script>
    <script src="./javascripts/dataChars.js"></script>
    <script src="./javascripts/dataHorse.js"></script>
    <script src="./javascripts/dataGeo.js"></script>
    <script src="./javascripts/dataGeoGlobal.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@0.7.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@0.7.3/dist/leaflet.js"></script>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Hull.js examples</h1>
        <h2></h2>
        <a href="https://github.com/AndriiHeonia/hull" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">


<!-- Example 1 -->
<h3><a name="ex1" class="anchor" href="#ex1"><span class="octicon octicon-link"></span>Basic Usage</a></h3>
<p>To get concave hull (polygon) by a set of points just call <code>hull</code> function:</p>
<pre><code>var pointset = [[90, 187], [91, 189], [92, 186], [93, 190], ...];
var pts = hull(pointset, 10);
// ... draw pts</code></pre>
<p>
  <canvas id="canv1" width="190" height="400"></canvas>
  <script>
  function example1() {
    var c = document.getElementById('canv1'),
        ctx = c.getContext('2d'),
        pointset = dataTorch;

    // draw all points
    ctx.fillStyle = "black";
    for (var i = 0; i < pointset.length; i++) {
        ctx.beginPath();
        ctx.arc(pointset[i][0], pointset[i][1], 1, 0, 2 * Math.PI, true);
        ctx.fill();
        ctx.closePath();
    }

    // get and draw hull
    var pts = hull(pointset, 10);
    ctx.strokeStyle = "blue";
    ctx.lineWidth = 2;
    ctx.beginPath();
    pts.forEach(function(px) {
        ctx.lineTo(px[0], px[1]);
        ctx.moveTo(px[0], px[1]);
    });
    ctx.stroke();
    ctx.closePath();
  }
  </script>
</p>
<!-- END: Example 1 -->



<!-- EXAMPLE 1.1 -->
<p>You can adjust concavity of a hull via 2nd param:</p>
<pre><code>var pointset = [[90, 187], [91, 189], [92, 186], [93, 190], ...];
var pts = hull(pointset, 80);
// ... draw pts</code></pre>
<p>
  <canvas id="canv1_1" width="190" height="400"></canvas>
  <script>
  function example1_1() {
    var c = document.getElementById('canv1_1'),
        ctx = c.getContext('2d'),
        pointset = dataTorch;

    // draw all points
    ctx.fillStyle = "black";
    for (var i = 0; i < pointset.length; i++) {
        ctx.beginPath();
        ctx.arc(pointset[i][0], pointset[i][1], 1, 0, 2 * Math.PI, true);
        ctx.fill();
        ctx.closePath();
    }

    // get and draw hull
    var pts = hull(pointset, 80);
    ctx.strokeStyle = "blue";
    ctx.lineWidth = 2;
    ctx.beginPath();
    pts.forEach(function(px) {
        ctx.lineTo(px[0], px[1]);
        ctx.moveTo(px[0], px[1]);
    });
    ctx.stroke();
    ctx.closePath();
  }
  </script>
</p>
<!-- END: Example 1.1 -->


<!-- Example 2 -->
<h3><a name="ex2" class="anchor" href="#ex2"><span class="octicon octicon-link"></span>Performance</a></h3>
<p>Hull.js also works well with large data sets. This example has more than 52K points, <code>concavity = 20</code>. Execution time in your browser: <span id="horseExecTime"></span> ms.</p>

<p>
  <canvas id="canv2" width="960" height="750"></canvas>
  <script>
  function example2() {
    var c = document.getElementById('canv2'),
        ctx = c.getContext('2d'),
        horseExecStart = 0,
        horseExecTime = 0,
        horseExecTimeSpan = document.getElementById('horseExecTime'),
        pointset = dataHorse;

    // draw all points
    ctx.fillStyle = "black";
    for (var i = 0; i < pointset.length; i++) {
        ctx.beginPath();
        ctx.arc(pointset[i][0], pointset[i][1], 1, 0, 2 * Math.PI, true);
        ctx.fill();
        ctx.closePath();
    }

    // get and draw hull
    horseExecStart = new Date();
    var pts = hull(pointset, 20);
    horseExecTime = new Date() - horseExecStart;

    ctx.strokeStyle = "blue";
    ctx.lineWidth = 2;
    ctx.beginPath();
    pts.forEach(function(px) {
        ctx.lineTo(px[0], px[1]);
        ctx.moveTo(px[0], px[1]);
    });
    ctx.stroke();
    ctx.closePath();

    horseExecTimeSpan.appendChild(document.createTextNode(horseExecTime));
  }
  </script>
</p>
<!-- END: Example 2 -->


<!-- Example 3 -->
<h3><a name="ex3" class="anchor" href="#ex3"><span class="octicon octicon-link"></span>Multiple Shapes</a></h3>
<p>If you want to get hulls of a point set that looks like a multipolygon, then you need to call <code>hull</code> function for each subset (for each polygon). In this example we use LukaszKrawczyk's <a href="https://github.com/LukaszKrawczyk/clustering" target="_blank">density based clustering library</a> (but you can use any other implementation) to split one large point set to several groups, after that we get hulls for each one:</p>
<pre><code>var clusters,
    dbscan = new DBSCAN(),
    pointset = [[14, 18], [22, 19], [23, 20], ...];

// get clusters
clusters = dbscan.run(pointset, 250, 50);
clusters = clusters.map(function(cluster) {
    return cluster.map(function(i) {
        return pointset[i]; // map index to point
    });
});

// get hulls
clusters.forEach(function(pointset) {
    var pts = hull(pointset, 30);
    // ... draw pts
});</code></pre>
<p>
  <canvas id="canv3" width="572" height="234"></canvas>
  <script>
  function example3() {
    var c = document.getElementById('canv3'),
        ctx = c.getContext('2d'),
        dbscan = new DBSCAN(),
        clusters,
        colors = ["red", "green", "blue"],
        pointset = dataChars;

    // draw all points
    for (var i = 0; i < pointset.length; i++) {
        ctx.beginPath();
        ctx.arc(pointset[i][0], pointset[i][1], 1, 0, 2 * Math.PI, true);
        ctx.fill();
        ctx.closePath();
    }

    // get clusters
    clusters = dbscan.run(pointset, 250, 50);
    clusters = clusters.map(function(cluster) {
        return cluster.map(function(i) {
            return pointset[i]; // map index to point
        });
    });

    // get and draw hull for each cluster
    ctx.lineWidth = 2;
    clusters.forEach(function(pointset, idx) {
        if(pointset.length < 50) { return; } // filter noise

        var pts = hull(pointset, 30);
        ctx.strokeStyle = colors[idx];
        ctx.beginPath();
        pts.forEach(function(pt) {
            ctx.lineTo(pt[0], pt[1]);
            ctx.stroke();
            ctx.moveTo(pt[0], pt[1]);
        });
        ctx.stroke();
        ctx.closePath();
    });
  }
  </script>
</p>
<!-- END: Example 3 -->

<!-- Example 3_1 -->

<p>Otherwise (without clustering) you'll get something like this:</p>
<pre><code>var pts = hull(pointset, 30);
// ... draw pts
</code></pre>
<p>
<canvas id="canv3_1" width="572" height="234"></canvas>
<script>
  function example3_1() {
    var c = document.getElementById('canv3_1'),
        ctx = c.getContext('2d'),
        pointset = dataChars;

    // draw all points
    for (var i = 0; i < pointset.length; i++) {
        ctx.beginPath();
        ctx.arc(pointset[i][0], pointset[i][1], 1, 0, 2 * Math.PI, true);
        ctx.fill();
        ctx.closePath();
    }

    // get and draw hull
    var pts = hull(pointset, 30);
    ctx.strokeStyle = 'blue';
    ctx.beginPath();
    pts.forEach(function(pt) {
        ctx.lineTo(pt[0], pt[1]);
        ctx.stroke();
        ctx.moveTo(pt[0], pt[1]);
    });
    ctx.stroke();
    ctx.closePath();
  }
</script>
</p>
<!-- END: Example 3_1 -->

<!-- Example 4 -->
<h3><a name="ex4" class="anchor" href="#ex4"><span class="octicon octicon-link"></span>Geo Points</a></h3>
<p>If your point format differs from the [x, y] then you can provide a custom format pattern:</p>
<pre><code>var pointset = [
    { lng: -0.2067, lat: 51.4911 },
    { lng: -0.2070, lat: 51.4915 },
    { lng: -0.2074, lat: 51.4912 },
    ...
];

var pts = hull(pointset, 0.0011, ['.lng', '.lat']);
// ... show pts on map</code></pre>
<p>
  <div id="map" style="width: 600px; height: 400px"></div>
  <script>
  function example4() {
    var map = L.map('map').setView([51.4894, -0.209], 15);
    pointset = dataGeo;
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    pointset.forEach(function(latlng) {
        L.circleMarker(latlng, {radius: 2}).addTo(map);
    });
    var pts = hull(pointset, 0.0011, ['.lng', '.lat']);
    L.polygon(pts, {weight: 2}).addTo(map);
  }
  </script>
</p>
<!-- END: Example 4 -->

<!-- Example 5 -->
<h3><a name="ex5" class="anchor" href="#ex5"><span class="octicon octicon-link"></span>Geo points on the globe</a></h3>
<p>All calculations in hull.js are based on cartesian coordinate system. If you use it for calculation and data visualization on the global map, don't forget that globe has the shape of geoid, latitude and longitude are angles (not points with X and Y), and after projection we have some map distortion. So, for the better accuracy you need to convert latitudes and longitudes to cartesian coordinates, calculate concave hull and then convert points back to the geo points. For example (using <a href="http://leafletjs.com/" target="_blank">Leaflet</a> library):</p>
<pre><code>var pointset = [
    { lng:-20, lat:90 },
    { lng:-20, lat:80 },
    { lng:-20, lat:70 },
    ...
];

var pts = pointset.map(map.latLngToContainerPoint.bind(map));
pts = hull(pts, 58, ['.x', '.y']);
pts = pts.map(function(pt) {
    return map.containerPointToLatLng(L.point(pt.x, pt.y));
});
// ... show pts on map</code></pre>
<p>
  <div id="map1" style="width: 600px; height: 525px"></div>
  <script>
  function example5() {
    var map = L.map('map1').setView([0, 0], 1);
    pointset = dataGeoGlobal;
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    pointset.forEach(function(latlng) {
        L.circleMarker(latlng, {radius: 2}).addTo(map);
    });
    var pts = pointset.map(map.latLngToContainerPoint.bind(map));
    pts = hull(pts, 58, ['.x', '.y']);
    pts = pts.map(function(pt) {
        return map.containerPointToLatLng(L.point(pt.x, pt.y));
    });
    L.polygon(pts, {weight: 2}).addTo(map);
  }
  </script>
</p>
<!-- END: Example 5 -->

        </section>
      </div>
    </div>
    <footer>
      <div class="inner">
        &copy; 2014-2024 Andrii Heonia
      </div>
    </footer>
    <script>
    window.onload = function() {
        example1();
        example1_1();
        example2();
        example3();
        example3_1();
        example4();
        example5();
    }
    </script>
  </body>
</html>
